version: '3.8'
services:
# ============================================
# TRAEFIK
# ============================================
traefik:
image: traefik:v2.10
container_name: selfhosting-traefik
restart: unless-stopped
ports:
- "80:80" # HTTP (interno)
- "8080:8080" # Dashboard
command:
- "--api.dashboard=true"
- "--api.insecure=true"
- "--providers.docker=true"
- "--providers.docker.exposedbydefault=false"
- "--providers.docker.network=selfhosting"
- "--entrypoints.web.address=:80"
- "--log.level=INFO"
- "--accesslog=true"
- "--metrics.prometheus=true"
volumes:
- /var/run/docker.sock:/var/run/docker.sock:ro
- traefik_config:/etc/traefik
networks:
- selfhosting
labels:
- "traefik.enable=true"
- "traefik.http.routers.traefik.rule=Host(`traefik.localhost`)"
- "traefik.http.routers.traefik.service=api@internal"
# ============================================
# WHOAMI (test service)
# ============================================
whoami:
image: traefik/whoami
container_name: selfhosting-whoami
restart: unless-stopped
networks:
- selfhosting
labels:
- "traefik.enable=true"
- "traefik.http.routers.whoami.rule=Host(`whoami.ejemplo.com`)"
- "traefik.http.routers.whoami.entrypoints=web"
- "traefik.http.services.whoami.loadbalancer.server.port=80"
- "selfhosting.app.name=whoami"
- "selfhosting.app.type=test"
- "selfhosting.app.domain=whoami.ejemplo.com"
volumes:
traefik_config:
networks:
selfhosting:
name: selfhosting
driver: bridge
