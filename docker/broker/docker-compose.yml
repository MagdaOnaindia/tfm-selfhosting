version: '3.8'
services:
broker:
build:
context: ../../src/TFM.Broker
dockerfile: Dockerfile
container_name: tfm-broker
restart: unless-stopped
ports:
- "127.0.0.1:5000:5000" # HTTP (solo local para Caddy)
- "50051:50051" # gRPC (expuesto a Internet)
volumes:
- ../../certs:/app/certs:ro
- ../../config:/app/config:ro
- ./logs:/app/logs
environment:
- ASPNETCORE_ENVIRONMENT=Production
- Routing__ConfigPath=/app/config/domains.json
- Certificates__BrokerCertPath=/app/certs/broker.pfx
- Certificates__BrokerCertPassword=dev123
- Certificates__CaCertPath=/app/certs/ca.crt
networks:
- broker-net
healthcheck:
test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
interval: 30s
timeout: 10s
retries: 3
networks:
broker-net:
driver: bridge
