# --- Etapa 1: Build ---
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src

# Copia los .csproj primero para cachear la restauraci칩n de dependencias
COPY TFM.Agent/TFM.Agent.csproj TFM.Agent/
COPY TFM.Contracts/TFM.Contracts.csproj TFM.Contracts/
RUN dotnet restore TFM.Agent/TFM.Agent.csproj

# Copia todo el c칩digo fuente
COPY . .

# Publica la aplicaci칩n
WORKDIR /src/TFM.Agent
RUN dotnet publish -c Release -o /app/publish

# --- Etapa 2: Final ---
FROM mcr.microsoft.com/dotnet/runtime:8.0 AS final
WORKDIR /app
# ... (El resto de tu Dockerfile del Agent con el usuario no-root est치 bien)
COPY --from=build /app/publish .
# ...
USER selfhosting
ENTRYPOINT ["dotnet", "TFM.Agent.dll"]
